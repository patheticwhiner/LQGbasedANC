# LQR设计失败问题分析记录

## 1. 问题描述

- 在 `preparemodel.m` 中，使用能观标准型的 `Ao`、`Bo` 设计 LQR 状态反馈控制器时，出现如下报错：
  > 无法计算稳定 LQR 增益(黎卡提解 S 和增益矩阵 K 为无穷大)。

- 已确认系统能控（能控性矩阵满秩，阶数为 30）。
- 已尝试多组 Q、R 参数（如 Q 很小、R 很大，或 Q=eye(nA), R=1），均报错。

---

## 2. 已排查内容

- **能控性**：`ctrb(Ao, Bo)` 满秩，系统理论上能控。
- **能观性**：`obsv(Ao, Co)` 满秩，系统理论上能观。
- **Q、R 参数**：已尝试多组参数，均无效。
- **Ao、Bo 形式**：采用能观标准型。

---

## 3. 可能原因分析

1. **系统阶数过高（nA=30）**
   - 高阶系统数值精度问题严重，容易导致黎卡提方程求解失败。
   - 建议尝试降阶（如 nA=6~10）测试。

2. **Bo 数值分布问题**
   - 虽然满秩，但 Bo 可能绝大部分元素极小，导致数值上“近似不可控”。
   - 建议检查 `min(abs(Bo))`、`max(abs(Bo))`。

3. **Ao 极点分布问题**
   - Ao 可能存在正实部极点，且这些极点数值上难以通过 Bo 控制。
   - 建议检查 `eig(Ao)`。

4. **Q、R 量纲/归一化问题**
   - 状态量和输入量量纲差异大时，Q、R 需归一化。
   - 可尝试对 Ao、Bo 归一化后再设计 LQR。

5. **数值病态**
   - 能控性矩阵虽然满秩，但条件数极大，数值上病态。
   - 建议检查 `cond(ctrb(Ao, Bo))`。

---

## 4. 建议的进一步操作

- 检查并记录 Bo 的数值范围、Ao 的极点、能控性矩阵的条件数。
- 尝试对 Ao、Bo 做归一化处理后再设计 LQR。
- 尝试降阶建模，验证低阶系统下 LQR 是否可行。
- 如有需要，可贴出上述检查结果，便于进一步分析。

---

## 5. 结论

- 问题极可能为高阶系统的数值病态或Bo/Ao分布导致的“近似不可控”。
- 参数本身（Q、R）调整难以根本解决，建议优先考虑降阶和归一化。

---

**请根据上述建议，补充相关数值检查结果或尝试降阶后反馈。**
